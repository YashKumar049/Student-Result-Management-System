<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>FA Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 font-sans">

    <nav class="bg-purple-800 p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <a class="text-white text-2xl font-bold" href="#">SRMS Faculty Advisor</a>
            <form th:action="@{/logout}" method="post" class="inline">
                <button type="submit" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded transition duration-300">
                    Logout (<span th:text="${fa.username}"></span>)
                </button>
            </form>
        </div>
    </nav>

    <div class="container mx-auto mt-8 p-4">

        <h2 class="text-3xl font-semibold text-gray-800 mb-6">
            Dashboard for Class: <span class="text-purple-700" th:text="${classAssigned}">10-A</span>
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            
            <div class="md:col-span-1 bg-white p-6 rounded-lg shadow-lg h-fit">
                <h3 class="text-xl font-semibold text-gray-700 border-b pb-2 mb-4">Your Profile</h3>
                <div class="space-y-3 text-gray-600">
                    <p><strong>Staff ID:</strong> <span th:text="${fa.teacherId}"></span></p>
                    <p><strong>Name:</strong> <span th:text="${fa.name}"></span></p>
                    <p><strong>Email:</strong> <span th:text="${fa.email}"></span></p>
                    <p><strong>Contact:</strong> <span th:text="${fa.contactNo}"></span></p>
                    <p><strong>Role:</strong> <span class="font-medium text-blue-600"
                                                 th:text="${fa.role}">ROLE_FA</span></p>
                    <p><strong>Assigned Class:</strong> <span class="font-medium text-green-600"
                                                          th:text="${fa.classAssigned}"></span></p>
                </div>
            </div>

            <div class="md:col-span-2 bg-white p-6 rounded-lg shadow-lg">
                <h3 class="text-xl font-semibold text-gray-700 border-b pb-2 mb-4">Class Statistics</h3>
                <div class="max-w-md mx-auto">
                    <canvas id="passFailChart"></canvas>
                </div>
            </div>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h3 class="text-xl font-semibold text-gray-700 border-b pb-2 mb-4">Complete Class Result</h3>
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white">
                    <thead class="bg-gray-800 text-white">
                        <tr>
                            <th class="py-2 px-4">Reg. No</th>
                            <th class="py-2 px-4">Name</th>
                            <th class="py-2 px-4">Maths</th>
                            <th class="py-2 px-4">Physics</th>
                            <th class="py-2 px-4">Chemistry</th>
                            <th class="py-2 px-4">Total</th>
                            <th class="py-2 px-4">Average</th>
                            <th class="py-2 px-4">Result</th>
                        </tr>
                    </thead>
                    <tbody class="text-gray-700">
                        <tr th:if="${#lists.isEmpty(studentsInClass)}">
                            <td colspan="8" class="text-center py-4">No students found in this class.</td>
                        </tr>
                        <tr th:each="student : ${studentsInClass}" class="border-b hover:bg-gray-50">
                            <td class="py-2 px-4 text-center" th:text="${student.rollno}">1</td>
                            <td class_=""py-2 px-4"" th:text="${student.name}">Student Name</td>
                            <td class="py-2 px-4 text-center" th:text="${student.maths}">90</td>
                            <td class="py-2 px-4 text-center" th:text="${student.physics}">90</td>
                            <td class="py-2 px-4 text-center" th:text="${student.chemistry}">90</td>
                            <td class_=""py-2 px-4 text-center font-semibold"" th:text="${student.total}">270</td>
                            <td class="py-2 px-4 text-center font-semibold" th:text="${#numbers.formatDecimal(student.average, 1, 2)}">90.00</td>
                            <td class="py-2 px-4 text-center font-bold"
                                th:text="${student.result}"
                                th:classappend="${student.result == 'Pass'} ? 'text-green-600' : (${student.result == 'Fail'} ? 'text-red-600' : 'text-gray-500')">
                                Pass
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="bg-white p-6 rounded-lg shadow-lg mt-6">
            <details>
                <summary class="text-xl font-semibold text-gray-700 cursor-pointer hover:text-blue-600">
                    Profile Settings (Change Password)
                </summary>
                
                <form th:action="@{/teacher/change-password}" method="post" class="mt-6 border-t pt-6">
                    <p class="text-gray-600 mb-4">Use this form to change your password.</p>
                    <div class="mb-4">
                        <label for="oldPassword" class="block text-sm font-medium text-gray-700">Old Password:</label>
                        <input type="password" name="oldPassword" id="oldPassword" required
                               class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                    <div class="mb-4">
                        <label for="newPassword" class="block text-sm font-medium text-gray-700">New Password:</label>
                        <input type="password" name="newPassword" id="newPassword" required
                               class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                    <div class="mb-6">
                        <label for="confirmPassword" class="block text-sm font-medium text-gray-700">Confirm New Password:</label>
                        <input type="password" name="confirmPassword" id="confirmPassword" required
                               class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                    <button type="submit"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
                        Change Password
                    </button>
                </form>
            </details>
        </div>

    </div>

    <script th:inline="javascript">
        /*<![CDATA[*/
        
        // 1. Controller se JSON data lena
        const chartDataJSON = /*[[${chartData}]]*/ '{}';
        
        // 2. JSON string ko JavaScript object mein badalna
        const chartData = JSON.parse(chartDataJSON.replace(/'/g, '"'));
        
        const passCount = chartData.Pass || 0;
        const failCount = chartData.Fail || 0;

        // 3. Chart banana
        const ctx = document.getElementById('passFailChart').getContext('2d');
        new Chart(ctx, {
            type: 'pie', // Chart ka type
            data: {
                labels: ['Pass', 'Fail'],
                datasets: [{
                    label: 'Class Result',
                    data: [passCount, failCount],
                    backgroundColor: [
                        'rgba(74, 222, 128, 0.7)',  // Green
                        'rgba(239, 68, 68, 0.7)'   // Red
                    ],
                    borderColor: [
                        'rgba(34, 197, 94, 1)',   // Dark Green
                        'rgba(220, 38, 38, 1)'    // Dark Red
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: 'Pass vs. Fail Percentage'
                    }
                }
            }
        });

        /*]]>*/
    </script>

</body>
</html>